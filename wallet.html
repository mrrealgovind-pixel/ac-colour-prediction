<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wallet | Recharge & Withdraw</title>
<style>
body{font-family:Arial;background:#0e0e0e;color:#fff;padding:20px;}
.card{background:#1a1a1a;padding:20px;border-radius:10px;margin-bottom:20px;}
input,select{width:100%;padding:10px;border:none;border-radius:6px;margin-top:10px;}
button{padding:10px 20px;margin-top:10px;background:#ff006e;border:none;border-radius:6px;color:#fff;cursor:pointer;}
.history-item{padding:10px;border-bottom:1px solid #333;}
</style>
</head>

<body>

<h2>ðŸ’° Wallet</h2>

<div class="card">
    <h3>Current Balance: <span id="balance">0</span></h3>
</div>

<!-- ADD COINS BUTTON -->
<div class="card">
    <h3>Add Coins</h3>
    <input id="addCoinsAmount" type="number" placeholder="Enter coin amount">
    <button onclick="openRecharge()">Proceed to Recharge</button>
</div>

<!-- WITHDRAW -->
<div class="card">
    <h3>Withdraw Coins</h3>
    <input id="withdrawAmount" type="number" placeholder="Enter amount">
    <input id="withdrawUPI" type="text" placeholder="Enter UPI ID">
    <button onclick="withdrawCoins()">Request Withdrawal</button>
</div>

<!-- History Buttons -->
<div class="card">
    <button onclick="loadRechargeHistory()">Recharge History</button>
    <button onclick="loadWithdrawHistory()">Withdraw History</button>
</div>

<!-- History -->
<div class="card" id="historyBox">
    <h3>History</h3>
    <div id="history"></div>
</div>

<script type="module">
/* Firebase Import */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_APP.firebaseapp.com",
    databaseURL: "YOUR_DB_URL",
    projectId: "YOUR_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "00000",
    appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase();

/* ------------------------ */
/* OPEN RECHARGE PAGE      */
/* ------------------------ */
function openRecharge(){
    let amount = document.getElementById("addCoinsAmount").value;
    if(amount < 10){ alert("Minimum 10 coins required!"); return; }

    window.location.href = "recharge.html?amount=" + amount;
}

/* ------------------------ */
/* WITHDRAW FUNCTION        */
/* ------------------------ */
function withdrawCoins(){
    let amount = document.getElementById("withdrawAmount").value;
    let upi = document.getElementById("withdrawUPI").value;

    if(amount < 50) { alert("Minimum withdrawal 50 coins!"); return; }

    push(ref(db, "withdrawRequests/"), {
        amount: amount,
        upi: upi,
        time: Date.now(),
        status: "Pending"
    });

    alert("Withdrawal request submitted!");
}

/* ------------------------ */
/* HISTORY SYSTEM           */
/* ------------------------ */
function loadRechargeHistory(){
    const box = document.getElementById("history");
    box.innerHTML = "Loading...";

    onValue(ref(db, "rechargeRequests/"), (snap)=>{
        box.innerHTML = "";
        snap.forEach(child=>{
            let d = child.val();
            box.innerHTML += `<div class="history-item">Recharge: ${d.amount} â€¢ ${d.status}</div>`;
        });
    });
}

function loadWithdrawHistory(){
    const box = document.getElementById("history");
    box.innerHTML = "Loading...";

    onValue(ref(db, "withdrawRequests/"), (snap)=>{
        box.innerHTML = "";
        snap.forEach(child=>{
            let d = child.val();
            box.innerHTML += `<div class="history-item">Withdraw: ${d.amount} â€¢ ${d.status}</div>`;
        });
    });
}
</script>

</body>
</html>
