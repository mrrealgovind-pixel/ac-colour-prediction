<!DOCTYPE html>
<html>
<head>
  <title>Wallet - AC Colour Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{background:#111;color:#fff;font-family:Arial;text-align:center;padding-top:30px}
    input,button{padding:12px;margin:8px;width:80%;font-size:16px}
    button{background:#ff9800;border:none;color:#000;font-weight:bold}
    .box{background:#000;padding:20px;margin:15px;border-radius:8px}
  </style>
</head>

<body>

<h2>ðŸ’° My Wallet</h2>

<div class="box">
  <p>Available Coins</p>
  <h1 id="coins">0</h1>
</div>

<div class="box">
  <h3>Withdraw Coins</h3>
  <input id="amount" type="number" placeholder="Enter amount (min 100)">
  <input id="upi" placeholder="Enter UPI ID">
  <button onclick="withdraw()">Request Withdraw</button>
  <p id="msg"></p>
</div>

<button onclick="goBack()">â¬… Back to Game</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let coins = 0;

auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="index.html";
  }else{
    db.collection("users").doc(user.uid).get().then(d=>{
      coins = d.data().coins;
      document.getElementById("coins").innerText = coins;
    });
  }
});

function withdraw(){
  const amt = parseInt(amount.value);
  const upiId = upi.value.trim();
  const user = auth.currentUser;

  if(amt < 100){
    msg.innerText = "Minimum withdraw 100 coins";
    return;
  }
  if(amt > coins){
    msg.innerText = "Insufficient balance";
    return;
  }
  if(!upiId.includes("@")){
    msg.innerText = "Invalid UPI ID";
    return;
  }

  db.collection("withdrawals").add({
    uid: user.uid,
    email: user.email,
    amount: amt,
    upi: upiId,
    status: "pending",
    time: firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{
    coins -= amt;
    db.collection("users").doc(user.uid).update({ coins });
    document.getElementById("coins").innerText = coins;
    msg.innerText = "âœ… Withdrawal request sent";
  });
}

function goBack(){
  location.href="game.html";
}
</script>

</body>
</html>
