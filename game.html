<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Game</title>
<script type="module">

// ---------------------- IMPORTS ----------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
    getAuth, 
    onAuthStateChanged, 
    signOut 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
    getFirestore,
    doc,
    getDoc,
    collection,
    addDoc,
    serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ---------------------- FIREBASE CONFIG ----------------------
const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "YOUR_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_ID",
    appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// ---------------------- USER CHECK ----------------------
onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "index.html";
        return;
    }

    document.getElementById("uid").innerText = user.uid;
});

// ---------------------- DEMO GAME LOGIC ----------------------
async function play(color) {
    const user = auth.currentUser;
    if (!user) return;

    const result = Math.random() < 0.5 ? "win" : "lose";
    
    // Save history
    await addDoc(collection(db, "transactions"), {
        uid: user.uid,
        color: color,
        result: result,
        created: serverTimestamp()
    });

    alert("You " + result);
}

window.play = play;

// ---------------------- LOGOUT ----------------------
function logout() {
    signOut(auth).then(() => {
        window.location.href = "index.html";
    });
}
window.logout = logout;

</script>

<style>
body { 
    font-family: Arial; 
    padding: 20px; 
    text-align: center;
}
button{
    padding: 12px 20px;
    margin: 10px;
}
</style>
</head>

<body>

<h2>Game Panel</h2>

<p>Logged in UID: <span id="uid"></span></p>

<button onclick="play('red')">Play Red</button>
<button onclick="play('green')">Play Green</button>

<br><br>
<a href="history.html" style="font-size:18px;">ðŸ“œ Transaction History</a>

<br><br>
<button onclick="logout()">Logout</button>

</body>
</html>
