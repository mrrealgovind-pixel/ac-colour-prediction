<!DOCTYPE html>
<html>
<head>
  <title>AC Colour Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
<button onclick="location.href='wallet.html'">ðŸ’° Wallet</button>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{margin:0;background:#0f0f0f;color:#fff;font-family:Arial;text-align:center}
    .header{background:#000;padding:12px;font-size:20px}
    .coins{margin:10px;color:#00e676;font-size:18px}
    .progress{width:90%;height:10px;background:#333;margin:auto;border-radius:5px}
    .bar{height:100%;background:#ff9800;width:100%}
    .history{margin:10px;font-size:18px}
    select,button{padding:12px;margin:6px;width:80%;font-size:16px}
    .red{background:#e53935;color:#fff}
    .green{background:#43a047;color:#fff}
    .violet{background:#8e24aa;color:#fff}
    .logout{background:#fff;color:#000;width:40%}
  </style>
</head>

<body>

<div class="header">AC Colour Prediction</div>
<div class="coins">Coins: <span id="coins">0</span></div>

<div class="progress"><div class="bar" id="bar"></div></div>

<div class="history" id="history">Last: â€” â€” â€” â€” â€”</div>

<select id="betAmount">
  <option value="50">Bet 50</option>
  <option value="100">Bet 100</option>
  <option value="500">Bet 500</option>
</select>

<button class="red" onclick="bet('Red')">RED</button>
<button class="green" onclick="bet('Green')">GREEN</button>
<button class="violet" onclick="bet('Violet')">VIOLET</button>

<p id="msg"></p>
<button class="logout" onclick="logout()">Logout</button>

<!-- Sounds -->
<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction"
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let coins=0, pick="", time=30;

auth.onAuthStateChanged(u=>{
  if(!u) location.href="index.html";
  else db.collection("users").doc(u.uid).get().then(d=>{
    coins = d.exists ? d.data().coins : 1000;
    document.getElementById("coins").innerText=coins;
  });
});

function bet(c){
  pick=c;
  msg.innerText="Selected "+c;
}

setInterval(()=>{
  time--;
  bar.style.width=(time/30*100)+"%";
  if(time<=0){ result(); time=30; }
},1000);

async function result(){
  let adminDoc = await db.collection("admin").doc("result").get();
  let win = adminDoc.exists ? adminDoc.data().color :
            ["Red","Green","Violet"][Math.floor(Math.random()*3)];

  let betAmt = parseInt(betAmount.value);

  if(pick===win){
    coins+=betAmt*2;
    winSound.play();
    msg.innerText="ðŸŽ‰ WIN "+win;
  }else{
    coins-=betAmt;
    loseSound.play();
    msg.innerText="âŒ LOSE "+win;
  }

  coins=Math.max(coins,0);
  document.getElementById("coins").innerText=coins;

  const u=auth.currentUser;
  if(u) db.collection("users").doc(u.uid).update({coins});

  db.collection("rounds").add({result:win,time:new Date()});
  loadHistory();
  pick="";
}

function loadHistory(){
  db.collection("rounds").orderBy("time","desc").limit(10).get()
  .then(s=>{
    let h=[];
    s.forEach(d=>h.push(d.data().result));
    history.innerText="Last: "+h.join(" ");
  });
}
loadHistory();

function logout(){
  auth.signOut().then(()=>location.href="index.html");
}
</script>

</body>
</html>
