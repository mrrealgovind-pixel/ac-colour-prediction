<!DOCTYPE html>
<html>
<head>
  <title>AC Colour Prediction - Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{background:#111;color:#fff;font-family:Arial;text-align:center;margin:0}
    .top{background:#000;padding:10px}
    .coins{font-size:18px;margin:10px}
    .timer{font-size:30px;margin:20px;color:#ff9800}
    button{padding:15px;margin:10px;width:80%;font-size:18px;border:none;font-weight:bold}
    .red{background:red;color:#fff}
    .green{background:green;color:#fff}
    .violet{background:violet;color:#000}
    .logout{background:#fff;color:#000;width:40%}
  </style>
</head>

<body>

<div class="top">
  <h2>AC Colour Prediction</h2>
</div>

<div class="coins">
  Coins: <span id="coins">0</span>
</div>

<div class="timer">
  Time Left: <span id="time">30</span>s
</div>

<h3>Minimum Bet: 50</h3>

<button class="red" onclick="bet('Red')">BET ON RED</button>
<button class="green" onclick="bet('Green')">BET ON GREEN</button>
<button class="violet" onclick="bet('Violet')">BET ON VIOLET</button>

<p id="result"></p>

<button class="logout" onclick="logout()">Logout</button>

<script>
  // ðŸ”¥ Firebase Config (READY)
  const firebaseConfig = {
    apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
    authDomain: "ac-colour-prediction.firebaseapp.com",
    projectId: "ac-colour-prediction",
    storageBucket: "ac-colour-prediction.appspot.com",
    messagingSenderId: "471938348888",
    appId: "1:471938348888:web:ac3fc3eb1939eb7cbe172d"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let coins = 0;
  let selectedColor = "";
  let time = 30;

  // ðŸ”’ Login protection & load coins
  auth.onAuthStateChanged(user=>{
    if(!user){
      window.location.href="index.html";
    }else{
      loadCoins(user.uid);
    }
  });

  function loadCoins(uid){
    db.collection("users").doc(uid).get().then(doc=>{
      if(doc.exists){
        coins = doc.data().coins;
      }else{
        coins = 1000;
        db.collection("users").doc(uid).set({ coins: coins });
      }
      document.getElementById("coins").innerText = coins;
    });
  }

  function bet(color){
    if(coins < 50){
      alert("Minimum 50 coins required");
      return;
    }
    selectedColor = color;
    document.getElementById("result").innerText =
      "Bet placed on " + color;
  }

  // â± Timer
  setInterval(()=>{
    time--;
    document.getElementById("time").innerText = time;

    if(time <= 0){
      showResult();
      time = 30;
      document.getElementById("time").innerText = time;
    }
  },1000);

  function showResult(){
    // ðŸ”´ Fetch live result from admin
    db.collection("admin").doc("result").get().then(doc=>{
      let winColor = "Red"; // default
      if(doc.exists) winColor = doc.data().color;

      if(selectedColor === winColor){
        coins += 100;
        document.getElementById("result").innerText =
          "ðŸŽ‰ Result: " + winColor + " | YOU WIN!";
      }else{
        coins -= 50;
        document.getElementById("result").innerText =
          "âŒ Result: " + winColor + " | YOU LOSE!";
      }

      document.getElementById("coins").innerText = coins;

      // ðŸ”„ Update coins in Firestore
      const user = auth.currentUser;
      if(user){
        db.collection("users").doc(user.uid).update({ coins: coins });
      }

      selectedColor = "";
    });
  }

  function logout(){
    auth.signOut().then(()=>{
      window.location.href="index.html";
    });
  }
</script>

</body>
  </html>
