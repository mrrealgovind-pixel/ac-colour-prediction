<!DOCTYPE html>
<html>
<head>
  <title>AC Colour Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body{
      margin:0;
      font-family:Arial;
      background:#0f0f0f;
      color:#fff;
      text-align:center;
    }
    .header{
      background:#000;
      padding:12px;
      font-size:20px;
      font-weight:bold;
    }
    .coins{
      margin:10px;
      font-size:18px;
      color:#00e676;
    }
    .progress{
      width:90%;
      height:10px;
      background:#333;
      margin:10px auto;
      border-radius:5px;
      overflow:hidden;
    }
    .bar{
      height:100%;
      width:100%;
      background:#ff9800;
      transition:width 1s linear;
    }
    .history{
      margin:10px;
      font-size:22px;
    }
    .buttons button{
      width:80%;
      padding:14px;
      margin:8px;
      font-size:18px;
      font-weight:bold;
      border:none;
      border-radius:5px;
    }
    .red{background:#e53935;color:#fff}
    .green{background:#43a047;color:#fff}
    .violet{background:#8e24aa;color:#fff}
    .msg{
      margin-top:10px;
      min-height:30px;
    }
    .logout{
      margin-top:20px;
      background:#fff;
      color:#000;
      padding:10px;
      width:40%;
      border:none;
      border-radius:5px;
    }
  </style>
</head>

<body>

<div class="header">AC Colour Prediction</div>

<div class="coins">Coins: <span id="coins">0</span></div>

<div class="progress">
  <div class="bar" id="bar"></div>
</div>

<div class="history" id="history">â€” â€” â€” â€” â€”</div>

<div class="buttons">
  <button class="red" onclick="bet('Red')">RED</button>
  <button class="green" onclick="bet('Green')">GREEN</button>
  <button class="violet" onclick="bet('Violet')">VIOLET</button>
</div>

<div class="msg" id="msg"></div>

<button class="logout" onclick="logout()">Logout</button>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
    authDomain: "ac-colour-prediction.firebaseapp.com",
    projectId: "ac-colour-prediction"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  let coins = 0;
  let betColor = "";
  let time = 30;
  let history = [];

  auth.onAuthStateChanged(user=>{
    if(!user){
      location.href="index.html";
    }else{
      db.collection("users").doc(user.uid).get().then(d=>{
        coins = d.exists ? d.data().coins : 1000;
        document.getElementById("coins").innerText = coins;
      });
    }
  });

  function bet(color){
    betColor = color;
    msg.innerText = "Selected: " + color;
  }

  setInterval(()=>{
    time--;
    document.getElementById("bar").style.width = (time/30*100)+"%";
    if(time<=0){
      result();
      time=30;
    }
  },1000);

  function result(){
    let colors=["Red","Green","Violet"];
    let win = colors[Math.floor(Math.random()*3)];

    history.unshift(win);
    history = history.slice(0,5);
    document.getElementById("history").innerText = history.join(" ");

    if(betColor===win){
      coins+=100;
      msg.innerText="ðŸŽ‰ WIN: "+win;
    }else{
      coins-=50;
      msg.innerText="âŒ LOSE: "+win;
    }

    document.getElementById("coins").innerText = coins;

    const user = auth.currentUser;
    if(user){
      db.collection("users").doc(user.uid).update({coins});
    }

    betColor="";
  }

  function logout(){
    auth.signOut().then(()=>location.href="index.html");
  }
</script>

</body>
</html>
