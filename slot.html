<!DOCTYPE html>
<html>
<head>
<title>Slot Machine - JILI Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
    margin: 0;
    background: radial-gradient(circle,#000,#111,#000);
    font-family: Arial;
    color: white;
    text-align: center;
}

h2 {
    margin-top: 20px;
    color: gold;
    text-shadow: 0 0 10px gold;
    font-size: 30px;
}

#coins, #bet {
    font-size: 22px;
    margin-top: 15px;
    font-weight: bold;
    color: #00ff9d;
}

.bet-btns button {
    width: 75px;
    padding: 8px;
    margin: 4px;
    border-radius: 8px;
    border: 1px solid gold;
    background: #222;
    color: gold;
    font-weight: bold;
}

.slot-box {
    width: 92%;
    margin: auto;
    background: linear-gradient(145deg,#1b1b1b,#0a0a0a);
    padding: 20px;
    border-radius: 20px;
    border: 3px solid gold;
    margin-top: 20px;
}

.reels {
    display: flex;
    justify-content: space-around;
}

.reel {
    width: 90px;
    height: 90px;
    background: black;
    border: 3px solid gold;
    border-radius: 12px;
    font-size: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.spin-anim {
    animation: spin 0.13s linear infinite;
}

@keyframes spin {
    0% { filter: blur(2px); }
    100% { filter: blur(3px); }
}

.win-glow {
    animation: glow 1s infinite alternate;
}

@keyframes glow {
    from { box-shadow: 0 0 10px gold; }
    to { box-shadow: 0 0 25px yellow; }
}

button.spin-btn {
    width: 180px;
    padding: 15px;
    margin-top: 25px;
    background: linear-gradient(135deg,#ffd700,#ffae00);
    border: none;
    border-radius: 15px;
    font-size: 22px;
    font-weight: bold;
    color: black;
}

#result {
    font-size: 26px;
    margin-top: 15px;
    font-weight: bold;
}
</style>
</head>

<body>

<h2>üé∞ JILI SLOT MACHINE</h2>

<div id="coins">Coins: 0</div>
<div id="bet">Bet: 10</div>

<div class="bet-btns">
    <button onclick="setBet(5)">5</button>
    <button onclick="setBet(10)">10</button>
    <button onclick="setBet(20)">20</button>
    <button onclick="setBet(50)">50</button>
    <button onclick="setBet(100)">100</button>
    <button onclick="setBet(150)">150</button>
    <button onclick="setBet(250)">250</button>
    <button onclick="setBet(500)">500</button>
    <button onclick="setBet(1000)">1000</button>
    <button onclick="setBet(2000)">2000</button>
</div>

<div class="slot-box">
    <div class="reels">
        <div id="r1" class="reel">üçí</div>
        <div id="r2" class="reel">üçã</div>
        <div id="r3" class="reel">‚≠ê</div>
    </div>

    <button class="spin-btn" onclick="spin()">SPIN</button>
</div>

<p id="result"></p>

<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>
<audio id="spinSound" src="spin.mp3"></audio>

<script>
/* -------------------- FIREBASE CONFIG -------------------- */
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction",
  storageBucket: "ac-colour-prediction.appspot.com",
};
firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.firestore();

let coins = 0;
let bet = 10;
let uid = null;

/* ------------ Load User Coins + Slot Control Settings ----------- */
let winRate = 40;      // percentage
let jackpotRate = 5;   // percentage

auth.onAuthStateChanged(async (user) => {
    if (!user) { location.href = "index.html"; return; }
    uid = user.uid;

    // User coins load
    const snap = await db.collection("users").doc(uid).get();
    if (snap.exists) {
        coins = snap.data().coins || 0;
        document.getElementById("coins").innerHTML = "Coins: " + coins;
    }

    // slot control load
    const ctrl = await db.collection("slotControl").doc("settings").get();
    if (ctrl.exists) {
        winRate = ctrl.data().winRate;
        jackpotRate = ctrl.data().jackpotRate;
    }
});

function setBet(amount) {
    bet = amount;
    document.getElementById("bet").innerHTML = "Bet: " + bet;
}

function updateCoins() {
    db.collection("users").doc(uid).update({ coins: coins });
    document.getElementById("coins").innerHTML = "Coins: " + coins;
}

async function spin() {

    if (coins < bet) {
        alert("Not enough coins!");
        return;
    }

    coins -= bet;
    updateCoins();

    const r1 = document.getElementById("r1");
    const r2 = document.getElementById("r2");
    const r3 = document.getElementById("r3");

    r1.classList.add("spin-anim");
    r2.classList.add("spin-anim");
    r3.classList.add("spin-anim");

    spinSound.play();
    if (navigator.vibrate) navigator.vibrate(100);

    const symbols = ["üçí","üçã","‚≠ê","üîî","üçâ","7Ô∏è‚É£"];

    setTimeout(() => {
        let s1, s2, s3;
        let win = 0;
        let message = "";

        let rand = Math.random() * 100;

        // ----- JACKPOT -----
        if (rand < jackpotRate) {
            s1 = s2 = s3 = "7Ô∏è‚É£";
            win = bet * 10;
            message = "üî• JACKPOT +" + win;
            winSound.play();
            navigator.vibrate([200,100,200]);
        }

        // ----- NORMAL WIN -----
        else if (rand < winRate + jackpotRate) {
            s1 = s2 = symbols[Math.floor(Math.random()*symbols.length)];
            s3 = symbols[Math.floor(Math.random()*symbols.length)];

            win = bet * 3;
            message = "‚ú® Win +" + win;
            winSound.play();
            navigator.vibrate(150);
        }

        // ----- LOSS -----
        else {
            s1 = symbols[Math.floor(Math.random()*symbols.length)];
            s2 = symbols[Math.floor(Math.random()*symbols.length)];
            s3 = symbols[Math.floor(Math.random()*symbols.length)];
            message = "‚ùå Try Again!";
            loseSound.play();
        }

        // Stop Animations
        r1.classList.remove("spin-anim");
        r2.classList.remove("spin-anim");
        r3.classList.remove("spin-anim");

        // Output symbols
        r1.innerHTML = s1;
        r2.innerHTML = s2;
        r3.innerHTML = s3;

        coins += win;
        updateCoins();

        document.getElementById("result").innerHTML = message;

        // Save spin history
        db.collection("transactions").add({
            uid, game: "slot", bet, win,
            r1: s1, r2: s2, r3: s3,
            time: new Date()
        });

    }, 1400);
}
</script>

</body>
        </html>
