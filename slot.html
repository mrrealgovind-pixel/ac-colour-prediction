<!DOCTYPE html>
<html>
<head>
<title>Slot Machine 3D - JILI Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body { margin:0; background: radial-gradient(circle,#000,#111,#000); font-family:Arial; color:white; text-align:center; }
h2 { margin-top:20px; color:gold; text-shadow:0 0 10px gold; font-size:30px; }
#coins,#bet { font-size:22px; margin-top:15px; font-weight:bold; color:#00ff9d; }
.bet-btns button { width:75px;padding:8px;margin:5px;border-radius:8px;border:1px solid gold;background:#222;color:gold;font-weight:bold; }
.slot-box { width:92%; margin:auto; background:linear-gradient(145deg,#1b1b1b,#0a0a0a); padding:20px; border-radius:20px; border:3px solid gold; box-shadow:0 0 25px rgba(255,215,0,0.4); margin-top:20px; }
.reels { display:flex; flex-direction:column; gap:5px; align-items:center; }
.row { display:flex; justify-content:space-around; overflow:hidden; height:90px; }
.reel { width:90px;height:90px;background:black;border:3px solid gold;border-radius:12px; font-size:50px; display:flex; justify-content:center; align-items:center; transform-style: preserve-3d; backface-visibility: hidden; }
.spin-btn { width:180px;padding:15px;margin-top:25px;background:linear-gradient(135deg,#ffd700,#ffae00); border:none;border-radius:15px;font-size:22px;font-weight:bold;color:black; box-shadow:0 0 20px gold; }
.win-glow { animation:glow 1s infinite alternate; }
@keyframes glow { from{box-shadow:0 0 10px gold;} to{box-shadow:0 0 25px yellow;} }
#result { font-size:26px;margin-top:15px;font-weight:bold; }
</style>
</head>
<body>

<h2>üé∞ 3D JILI SLOT MACHINE</h2>
<div id="coins">Coins: 0</div>
<div id="bet">Bet: 10</div>

<div class="bet-btns">
<button onclick="setBet(10)">10</button>
<button onclick="setBet(20)">20</button>
<button onclick="setBet(50)">50</button>
<button onclick="setBet(100)">100</button>
</div>

<div class="slot-box">
<div class="reels">
  <div class="row" id="row_top">
      <div class="reel" id="r1_top">üçí</div>
      <div class="reel" id="r2_top">üçã</div>
      <div class="reel" id="r3_top">‚≠ê</div>
  </div>
  <div class="row" id="row_mid">
      <div class="reel" id="r1_mid">üçã</div>
      <div class="reel" id="r2_mid">‚≠ê</div>
      <div class="reel" id="r3_mid">üîî</div>
  </div>
  <div class="row" id="row_bot">
      <div class="reel" id="r1_bot">üçí</div>
      <div class="reel" id="r2_bot">üçã</div>
      <div class="reel" id="r3_bot">‚≠ê</div>
  </div>
</div>
<button class="spin-btn" onclick="spin()">SPIN</button>
</div>

<p id="result"></p>

<audio id="winSound" src="win.mp3"></audio>
<audio id="loseSound" src="lose.mp3"></audio>
<audio id="spinSound" src="spin.mp3"></audio>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction",
  storageBucket: "ac-colour-prediction.appspot.com",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let coins=0, bet=10, uid=null;
let winRate=40, jackpotRate=5;

auth.onAuthStateChanged(async user=>{
  if(!user){ location.href="index.html"; return; }
  uid=user.uid;
  const snap=await db.collection("users").doc(uid).get();
  if(snap.exists){ coins=snap.data().coins||0; document.getElementById("coins").innerHTML="Coins:"+coins; }
  const ctrl=await db.collection("slotControl").doc("settings").get();
  if(ctrl.exists){ winRate=ctrl.data().winRate; jackpotRate=ctrl.data().jackpotRate; }
});

function setBet(amount){ bet=amount; document.getElementById("bet").innerHTML="Bet:"+bet; }
function updateCoins(){ db.collection("users").doc(uid).update({coins}); document.getElementById("coins").innerHTML="Coins:"+coins; }

function spin(){
  if(coins<bet){ alert("Not enough coins!"); return; }
  coins-=bet; updateCoins();

  const top=[r1_top,r2_top,r3_top].map(id=>document.getElementById(id));
  const mid=[r1_mid,r2_mid,r3_mid].map(id=>document.getElementById(id));
  const bot=[r1_bot,r2_bot,r3_bot].map(id=>document.getElementById(id));
  const symbols=["üçí","üçã","‚≠ê","üîî","üçâ","7Ô∏è‚É£"];
  spinSound.play(); if(navigator.vibrate) navigator.vibrate(100);

  let spins=30; // more spins for 3D effect
  let count=0;
  const interval=setInterval(()=>{
    [top,mid,bot].flat().forEach(r=>{
      r.style.transform=`rotateX(${360*count/spins}deg)`;
      r.innerHTML=symbols[Math.floor(Math.random()*symbols.length)];
      r.style.filter="blur(2px)";
    });
    count++;
    if(count>=spins){
      clearInterval(interval);
      // Bottom line controlled
      let rand=Math.random()*100, s1,s2,s3,win=0,message="";
      if(rand<jackpotRate){ s1=s2=s3="7Ô∏è‚É£"; win=bet*10; message="üî• JACKPOT! +"+win; bot.forEach(r=>r.classList.add("win-glow")); winSound.play(); if(navigator.vibrate) navigator.vibrate([200,100,200]); }
      else if(rand<winRate+jackpotRate){ s1=s2=symbols[Math.floor(Math.random()*symbols.length)]; s3=symbols[Math.floor(Math.random()*symbols.length)]; win=bet*3; message="‚ú® Win +"+win; winSound.play(); if(navigator.vibrate) navigator.vibrate(150); }
      else{ s1=symbols[Math.floor(Math.random()*symbols.length)]; s2=symbols[Math.floor(Math.random()*symbols.length)]; s3=symbols[Math.floor(Math.random()*symbols.length)]; message="‚ùå Try Again!"; loseSound.play(); }
      bot[0].innerHTML=s1; bot[1].innerHTML=s2; bot[2].innerHTML=s3;
      [top,mid,bot].flat().forEach(r=>r.style.transform="rotateX(0deg)"); r.style.filter="blur(0)";
      
      // Multi-line check
      let lines=[top,mid,bot]; win=0; message="‚ùå Try Again!";
      lines.forEach((line,i)=>{
        if(line[0].innerHTML===line[1].innerHTML && line[1].innerHTML===line[2].innerHTML){
          let lineWin=(i===2)? bet*10 : bet*3;
          win+=lineWin; message="‚ú® Win +"+win;
          line.forEach(r=>r.classList.add("win-glow"));
          winSound.play(); if(navigator.vibrate) navigator.vibrate([150,50,150]);
        }
      });
      coins+=win; updateCoins();
      document.getElementById("result").innerHTML=message;
      db.collection("transactions").add({
        uid, game:"slot", bet, win,
        top: top.map(r=>r.innerHTML),
        mid: mid.map(r=>r.innerHTML),
        bot: bot.map(r=>r.innerHTML),
        time:new Date()
      });
      setTimeout(()=>[top,mid,bot].flat().forEach(r=>r.classList.remove("win-glow")),1200);
    }
  },50);
}
</script>
</body>
</html>
