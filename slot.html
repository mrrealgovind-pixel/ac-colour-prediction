<!DOCTYPE html>
<html>
<head>
<title>Slot Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#111; color:white; text-align:center; }
.slot-box { font-size:45px; margin:20px auto; width:200px; padding:15px; background:#222; border-radius:10px; }
button { padding:12px 25px; font-size:18px; border:0; border-radius:8px; background:#28a745; color:white; }
input { padding:10px; font-size:18px; width:120px; text-align:center; }
.result { margin-top:20px; font-size:20px; }
.history-table { width:95%; margin:20px auto; border-collapse: collapse; }
.history-table th, .history-table td { border:1px solid #555; padding:8px; }
</style>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// YOUR FIREBASE CONFIG
const firebaseConfig = {
   apiKey: "YOUR_KEY",
   authDomain: "YOUR_APP",
   databaseURL: "YOUR_DB",
   projectId: "YOUR_PROJECT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let logicMode = 1; // Default

// ---- FETCH LOGIC FROM ADMIN PANEL ----
db.ref("Admin/slotLogic").on("value", (snap) => {
    if (snap.exists()) {
        logicMode = snap.val();
        console.log("Current Logic:", logicMode);
    }
});

// ---- SLOT SPIN FUNCTION ----
function spinSlot() {
    let bet = parseInt(document.getElementById("bet").value);

    if (!bet || bet <= 0) {
        alert("Enter valid bet");
        return;
    }

    // 3 random symbols
    let symbols = ["üçí", "‚≠ê", "üíé", "7Ô∏è‚É£"];
    let slot1 = symbols[Math.floor(Math.random()*symbols.length)];
    let slot2 = symbols[Math.floor(Math.random()*symbols.length)];
    let slot3 = symbols[Math.floor(Math.random()*symbols.length)];

    let willWin = false;
    let r = Math.random();

    // LOGIC 1 = 60% WIN
    if (logicMode == 1) {
        willWin = (r < 0.60);
    }
    // LOGIC 2 = 60% LOSE
    else if (logicMode == 2) {
        willWin = !(r < 0.60);
    }

    let winAmount = 0;

    if (willWin) {
        slot1 = slot2 = slot3 = "7Ô∏è‚É£"; // jackpot 3 same symbols
        winAmount = bet * 5; // 5x multiplier
    }

    document.getElementById("s1").innerText = slot1;
    document.getElementById("s2").innerText = slot2;
    document.getElementById("s3").innerText = slot3;

    document.getElementById("result").innerHTML =
        willWin ? "You Won: ‚Çπ" + winAmount : "You Lost";

    saveHistory(bet, winAmount, willWin);
}

// ---- SAVE HISTORY ----
function saveHistory(bet, winAmount, win) {
    let id = Date.now();
    db.ref("SlotHistory/" + id).set({
        bet: bet,
        win: winAmount,
        result: win ? "WIN" : "LOSE",
        time: new Date().toLocaleString()
    });

    loadHistory();
}

// ---- LOAD HISTORY ----
function loadHistory() {
    db.ref("SlotHistory").limitToLast(20).on("value", (snap) => {
        let html = "";
        snap.forEach((data) => {
            let d = data.val();
            html += `
                <tr>
                    <td>${d.time}</td>
                    <td>‚Çπ${d.bet}</td>
                    <td>${d.result}</td>
                    <td>‚Çπ${d.win}</td>
                </tr>`;
        });
        document.getElementById("history").innerHTML = html;
    });
}

</script>

</head>
<body>

<h2>Slot Machine</h2>

<div class="slot-box">
    <span id="s1">üçí</span>
    <span id="s2">‚≠ê</span>
    <span id="s3">üíé</span>
</div>

<input id="bet" type="number" placeholder="Enter Bet"><br><br>
<button onclick="spinSlot()">SPIN</button>

<div class="result" id="result"></div>

<h3>History</h3>
<table class="history-table">
<tr><th>Time</th><th>Bet</th><th>Result</th><th>Win</th></tr>
<tbody id="history"></tbody>
</table>

<script> loadHistory(); </script>

</body>
</html>
