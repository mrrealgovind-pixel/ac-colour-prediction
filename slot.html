<!DOCTYPE html>
<html>
<head>
<title>Slot Machine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
    margin: 0;
    background: #000;
    color: white;
    font-family: Arial;
    text-align: center;
}
h2 { margin-top: 20px; color: gold; font-size: 28px; }
#coins,#bet { font-size:22px; margin-top:15px; font-weight:bold; color:#00ff9d; }

.bet-btns button {
    width:75px;padding:8px;margin:5px;border-radius:8px;
    border:1px solid gold;background:#222;color:gold;font-weight:bold;
}

.slot-box {
    width:92%;margin:auto;background:#111;
    padding:20px;border-radius:20px;border:2px solid gold;
    margin-top:20px;
}

.row { display:flex; justify-content:space-around; align-items:center; height:95px; }
.reel {
    width:90px;height:90px;background:black;border:3px solid gold;border-radius:12px;
    font-size:50px; display:flex; justify-content:center; align-items:center;
    transform: translateY(-120%); transition: transform 0.6s ease;
}
.win-col {
    width:80px; height:90px; background:#222;
    border:2px solid #0f0; color:#0f0; font-size:22px;
    display:flex; align-items:center; justify-content:center; border-radius:10px;
}
.win-glow { animation: glow 1s infinite alternate; }
@keyframes glow { from{box-shadow:0 0 10px gold;} to{box-shadow:0 0 25px yellow;} }

.spin-btn {
    width:180px;padding:15px;margin-top:25px;background:gold;
    border:none;border-radius:15px;font-size:22px;font-weight:bold;color:black;
}
#result { font-size:26px;margin-top:15px;font-weight:bold; }
</style>
</head>

<body>

<h2>üé∞ SLOT MACHINE</h2>
<div id="coins">Coins: 0</div>
<div id="bet">Bet: 10</div>

<div class="bet-btns">
<button onclick="setBet(10)">10</button>
<button onclick="setBet(20)">20</button>
<button onclick="setBet(50)">50</button>
<button onclick="setBet(100)">100</button>
</div>

<div class="slot-box">

    <!-- ROW 1 -->
    <div class="row">
        <div id="r1_top" class="reel">üçí</div>
        <div id="r2_top" class="reel">üçã</div>
        <div id="r3_top" class="reel">‚≠ê</div>
        <div id="win_top" class="win-col">0</div>
    </div>

    <!-- ROW 2 -->
    <div class="row">
        <div id="r1_mid" class="reel">üçã</div>
        <div id="r2_mid" class="reel">‚≠ê</div>
        <div id="r3_mid" class="reel">üîî</div>
        <div id="win_mid" class="win-col">0</div>
    </div>

    <!-- ROW 3 -->
    <div class="row">
        <div id="r1_bot" class="reel">üçí</div>
        <div id="r2_bot" class="reel">üçã</div>
        <div id="r3_bot" class="reel">‚≠ê</div>
        <div id="win_bot" class="win-col">0</div>
    </div>

    <button class="spin-btn" onclick="spin()">SPIN</button>
</div>

<p id="result"></p>

<script>
/* FIREBASE */
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let coins=0, bet=10, uid=null;
let winRate=50, loseRate=50;

auth.onAuthStateChanged(async (user)=>{
    if(!user){ location.href="index.html"; return; }
    uid = user.uid;

    const snap = await db.collection("users").doc(uid).get();
    coins = snap.data().coins || 0;
    document.getElementById("coins").innerHTML="Coins: "+coins;

    const ctrl = await db.collection("control").doc("panel").get();
    if(ctrl.exists){
        winRate = ctrl.data().winRate;
        loseRate = ctrl.data().loseRate;
    }
});

function setBet(x){ bet=x; document.getElementById("bet").innerHTML="Bet: "+bet; }
function updateCoins(){ db.collection("users").doc(uid).update({coins}); document.getElementById("coins").innerHTML="Coins:"+coins; }

/* SYMBOL MULTIPLIERS */
function getMultiplier(sym){
    if(sym==="üçí") return 2;
    if(sym==="‚≠ê") return 10;
    if(sym==="7Ô∏è‚É£") return 4;
    return 2;   // üîî üçã üçâ
}

async function spin(){

    if(coins < bet){ alert("Not enough coins!"); return; }
    coins -= bet; updateCoins();

    const rows = [
        ["r1_top","r2_top","r3_top"],
        ["r1_mid","r2_mid","r3_mid"],
        ["r1_bot","r2_bot","r3_bot"]
    ];

    const winBox = ["win_top","win_mid","win_bot"];

    const symbols=["üçí","üçã","‚≠ê","üîî","üçâ","7Ô∏è‚É£"];

    // Clear old glow + win text
    rows.flat().forEach(id => document.getElementById(id).classList.remove("win-glow"));
    winBox.forEach(id => document.getElementById(id).innerHTML="0");

    /** ADMIN DECISION */
    let adminPass = (Math.random()*100) < winRate;  // True ‚Üí win allowed

    /** ASSIGN SYMBOLS */
    rows.forEach((row,i)=>{
        row.forEach(id=>{
            document.getElementById(id).style.transform="translateY(-120%)";
            document.getElementById(id).innerHTML = symbols[Math.floor(Math.random()*symbols.length)];
        });
    });

    setTimeout(()=>{

        let totalWin = 0;

        rows.forEach((row,rowIndex)=>{

            let a = document.getElementById(row[0]).innerHTML;
            let b = document.getElementById(row[1]).innerHTML;
            let c = document.getElementById(row[2]).innerHTML;

            let rowWin = 0;

            if(adminPass){
                if(a === b && b === c){
                    let multi = getMultiplier(a);
                    rowWin = bet * multi;
                    totalWin += rowWin;

                    document.getElementById(row[0]).classList.add("win-glow");
                    document.getElementById(row[1]).classList.add("win-glow");
                    document.getElementById(row[2]).classList.add("win-glow");
                }
            }

            document.getElementById(winBox[rowIndex]).innerHTML = rowWin;
        });

        coins += totalWin;
        updateCoins();

        document.getElementById("result").innerHTML = 
            totalWin>0 ? "WIN +"+totalWin : "TRY AGAIN";

    },600);

    // Slide animation finish
    rows.flat().forEach(id=>{
        setTimeout(()=>document.getElementById(id).style.transform="translateY(0)",100);
    });
}
</script>

</body>
   </html>
