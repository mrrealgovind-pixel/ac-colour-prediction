<!DOCTYPE html>
<html>
<head>
  <title>History - AC Colour Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { background:#111;color:#fff;font-family:Arial;padding:10px; }
    h2 { text-align:center; }

    .card {
      background:#222;padding:12px;margin:8px;border-radius:8px;
      border-left:5px solid #0af;
    }
    .win { border-left-color:#00e676; }
    .lose { border-left-color:#ff5252; }
  </style>
</head>
<body>

<h2>Game History</h2>
<div id="historyBox">Loading...</div>

<script>
/* ---------- FIREBASE ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ---------- AUTH CHECK ---------- */
auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="index.html";
  } else {
    loadHistory(user.uid);
  }
});

/* ---------- LOAD TRANSACTIONS HISTORY ---------- */
function loadHistory(uid){
  db.collection("transactions")
    .where("uid","==",uid)
    .orderBy("time","desc")
    .onSnapshot(snap=>{

      if(snap.empty){
        historyBox.innerHTML = "<p>No Game History Found.</p>";
        return;
      }

      let html = "";

      snap.forEach(doc=>{
        const d = doc.data();

        let status = d.win ? "Win" : "Lose";
        let cls = d.win ? "win" : "lose";

        let bet = d.bet || 0;
        let color = d.color || "-";
        let result = d.result || "-";

        let t = "";
        try {
          t = d.time.toDate().toLocaleString();
        } catch(e){
          t = "—";
        }

        html += `
          <div class="card ${cls}">
            <b>${status}</b> — ${color}<br>
            Bet: <b>${bet}</b><br>
            Result: <b>${result}</b><br>
            <small>${t}</small>
          </div>
        `;
      });

      historyBox.innerHTML = html;
    });
}
</script>

</body>
  </html>
