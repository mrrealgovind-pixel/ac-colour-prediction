<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Transaction History</title>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
    getAuth, 
    onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
    getFirestore,
    collection,
    query,
    where,
    orderBy,
    getDocs
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "YOUR_KEY",
    authDomain: "YOUR_DOMAIN",
    projectId: "YOUR_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_ID",
    appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async (user) => {
    if (!user) {
        window.location.href = "index.html";
        return;
    }

    loadHistory(user.uid);
});

async function loadHistory(uid) {

    const q = query(
        collection(db, "transactions"),
        where("uid", "==", uid),
        orderBy("created", "desc")
    );

    const snap = await getDocs(q);

    let html = "";

    snap.forEach(doc => {
        const d = doc.data();
        html += `
            <div style="padding:10px;border-bottom:1px solid #ccc;">
                <b>Color:</b> ${d.color}<br>
                <b>Result:</b> ${d.result}<br>
            </div>
        `;
    });

    document.getElementById("list").innerHTML = html || "No history found.";
}

</script>

</head>
<body>

<h2>Transaction History</h2>
<div id="list"></div>

</body>
</html>
