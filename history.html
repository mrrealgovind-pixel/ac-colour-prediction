<!DOCTYPE html>
<html>
<head>
  <title>History - AC Colour Prediction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body { background:#111;color:#fff;font-family:Arial;padding:10px; }
    h2 { text-align:center; }
    .card {
      background:#222;padding:10px;margin:8px;border-radius:8px;
      border-left:5px solid #0af;
    }
    .green { border-left-color: #00e676; }
    .red { border-left-color: #ff5252; }
    .orange { border-left-color: #ffab00; }
  </style>
</head>
<body>

<h2>Transaction History</h2>

<div id="historyBox">Loading...</div>

<script>
/* ---------- FIREBASE ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ---------- AUTH CHECK ---------- */
auth.onAuthStateChanged(user=>{
  if(!user){
    location.href="index.html";
  } else {
    loadHistory(user.uid);
  }
});

/* ---------- LOAD HISTORY ---------- */
function loadHistory(uid){
  db.collection("transactions")
    .where("uid", "==", uid)
    .orderBy("time", "desc")
    .onSnapshot(snap=>{
      let html = "";

      if(snap.empty){
        historyBox.innerHTML = "<p>No history found.</p>";
        return;
      }

      snap.forEach(doc=>{
        const t = doc.data();
        let colorClass = "card";

        if(t.type.includes("Win")) colorClass += " green";
        else if(t.type.includes("Lose")) colorClass += " red";
        else colorClass += " orange";

        html += `
          <div class="${colorClass}">
            <b>${t.type}</b><br>
            Coins: <b>${t.coins}</b><br>
            <small>${t.time ? t.time.toDate().toLocaleString() : ""}</small>
          </div>
        `;
      });

      historyBox.innerHTML = html;
    });
}
</script>

</body>
</html>
