<!DOCTYPE html>
<html>
<head>
<title>Recharge</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
    background:#0f0f0f;
    color:#fff;
    font-family: Arial;
    padding:15px;
}
.card{
    background:#1c1c1c;
    padding:15px;
    border-radius:10px;
    margin-top:15px;
}
button{
    width:100%;
    padding:12px;
    background:#00e676;
    border:none;
    border-radius:6px;
    font-weight:bold;
    margin-top:10px;
}
input{
    width:100%;
    padding:10px;
    border-radius:6px;
    margin-top:10px;
}
</style>

</head>

<body>

<h2>ðŸ’³ Recharge Coins</h2>

<div class="card">
    <h3>Recharge Amount: <span id="amountText"></span></h3>
</div>

<div class="card">
    <h3>ðŸ“¸ Upload Payment Screenshot</h3>
    <input type="file" id="ss" accept="image/*">
    <button onclick="submitRecharge()">Submit Recharge</button>
</div>

<script>
/* ------------ Firebase Config ------------ */
const firebaseConfig = {
  apiKey: "AIzaSyAPFM1XnrX1A4cwQPCAkZ4sTMmnwORjx0A",
  authDomain: "ac-colour-prediction.firebaseapp.com",
  projectId: "ac-colour-prediction"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

/* ------------ Get Amount from URL ------------ */
const urlParams = new URLSearchParams(window.location.search);
const amount = urlParams.get("amount");
document.getElementById("amountText").innerText = amount;

/* ------------ Auth ------------ */
let UID = "";
auth.onAuthStateChanged(user=>{
    if(!user) location.href = "index.html";
    UID = user.uid;
});

/* ------------ Recharge Submit ------------ */
async function submitRecharge(){
    const fileInput = document.getElementById("ss");

    if(!fileInput.files[0]){
        alert("Please upload screenshot");
        return;
    }

    // screenshot ko base64 convert
    const reader = new FileReader();
    reader.onload = async function(event){

        const base64Img = event.target.result;

        await db.collection("rechargeRequests").add({
            uid: UID,
            amount: Number(amount),
            screenshot: base64Img,
            status: "Pending",
            time: new Date()
        });

        alert("Recharge Request Submitted! Admin will approve it.");
        window.location.href = "wallet.html";
    };

    reader.readAsDataURL(fileInput.files[0]);
}
</script>

</body>
    </html>
